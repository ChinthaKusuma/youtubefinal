{% extends 'home.html' %} {% load static %} {% block single %}
<link rel="stylesheet" href="{% static 'css/single.css' %}" type="text/css" />
{% endblock single %} {% block style %}
<link rel="stylesheet" href="{% static 'css/style.css' %}" type="text/css" />
{% endblock style %} {% block content %}

<style>
  .fa {
    color: black;
  }
  a {
    color: black;
  }
  #channel-tag {
    color: blue;
  }
  .unsubscribe-btn {
    background-color: gray;
    color: #fff;
  }
</style>

<main class="single_pages">
  <section class="video_items flex">
    <h1>one</h1>
    <div class="left">
      <div class="left_content">
        <video controls style="object-fit: cover">
          <source src="{{ video.video.url }}" type="video/mp4" />
          <p>{{video.video.url}}</p>
        </video>

        <div class="tag">
          <label for="" class="tags">
            {% for tag in video.tags.all %}
            <a id="channel-tag" href="{% url 'tags' tag.slug %}"
              >#{{tag.name}}</a
            >
            {% endfor %}
          </label>
          <p>{{ video.title }}</p>
        </div>

        <div class="view flex2 border_bottom">
          <div class="view-text">
            <span>{{ video.views }} Views</span>
          </div>

          <div class="flex">
            <div class="icon">
              <button id="like-button" onclick="addlike()">
                <i class="fa fa-thumbs-up"></i>
              </button>
              <label
                ><span id="like-count">{{ video.likes.count }}</span></label
              >
            </div>

            <div class="icon">
              <button id="dislike-button" onclick="adddislike()">
                <i class="fa fa-thumbs-down"></i>
              </button>
              <label
                ><span id="dislike-count"
                  >{{ video.dislikes.count }}</span
                ></label
              >
            </div>

            <div class="icon">
              <a href="{% url 'save-video' video.id %}">
                <i class="fa fa-bookmark"></i>
                <label>Save</label>
              </a>
            </div>
          </div>
        </div>

        <div class="details flex border_bottom">
          <div class="img">
            {% if video.user.channel.image %}
            <img
              src="{{ video.user.channel.image.url }}"
              style="width: 50px; height: 50px; object-fit: cover"
            />
            {% else %}
            <img
              src="https://thumbs.dreamstime.com/b/default-avatar-profile-icon-vector-social-media-user-portrait-176256935.jpg"
              style="width: 50px; height: 50px; object-fit: cover"
            />
            {% endif %}
          </div>
          <div class="heading">
            <h4>
              {{ video.user.channel.channel_name }} {% if
              video.user.channel.verified %}
              <small><i class="fa fa-check-circle"></i></small>
              {% endif %}
            </h4>
            <span id="sub-count"
              >{{ video.user.channel.subscribers.count }}</span
            >
            Subscribers
          </div>
          <div>
            <button
              id="sub_btn"
              onclick="toggleSubscription()"
              class="subscribe-btn"
            >
              Subscribe
            </button>
          </div>
        </div>

        <div class="comment">
          <h4><b>{{ comments.count }} Comments</b></h4>
          {% if request.user.is_authenticated %}
          <form id="comment_form">
            {% csrf_token %}
            <input type="hidden" value="{{ video.id }}" id="video-id" />
            <input
              type="text"
              placeholder="Add a comment..."
              id="comment-text"
            />
            <button type="submit">Submit</button>
          </form>
          {% else %}
          <a href="{% url 'sign-in' %}">Login To Comment</a>
          {% endif %}
        </div>
      </div>
    </div>
  </section>
</main>

<script>
  function addlike() {
    fetch("{% url 'add_like' video.id %}")
      .then((response) => response.json())
      .then((data) => {
        document.getElementById("like-count").innerText = data.likes;
      });
  }

  function adddislike() {
    fetch("{% url 'add_dislike' video.id %}")
      .then((response) => response.json())
      .then((data) => {
        document.getElementById("dislike-count").innerText = data.dislikes;
      });
  }

  function toggleSubscription() {
    fetch("{% url 'toggle_subscription' video.user.id %}")
      .then((response) => response.json())
      .then((data) => {
        document.getElementById("sub-count").innerText = data.subscribers;
      });
  }
</script>
{% endblock content %}
